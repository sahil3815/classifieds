(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||a(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var i,a,l,n,c=[],o=!0,d=!1;try{if(l=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;o=!1}else for(;!(o=(i=l.call(r)).done)&&(c.push(i.value),c.length!==e);o=!0);}catch(t){d=!0,a=t}finally{try{if(!o&&null!=r.return&&(n=r.return(),Object(n)!==n))return}finally{if(d)throw a}}return c}}(t,e)||a(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=a(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var i=0,l=function(){};return{s:l,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,c=!0,o=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return c=t.done,t},e:function(t){o=!0,n=t},f:function(){try{c||null==r.return||r.return()}finally{if(o)throw n}}}}function a(t,e){if(t){if("string"==typeof t)return l(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(t,e):void 0}}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=Array(e);r<e;r++)i[r]=t[r];return i}function n(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,d(i.key),i)}}function c(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function o(t,e,r){return(e=d(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function d(e){var r=function(e,r){if("object"!=t(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var a=i.call(e,r||"default");if("object"!=t(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}(e,"string");return"symbol"==t(r)?r:r+""}const s=c(function t(){var a=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),o(this,"deprecatedMessage",'<span class="rtcl-deprecated" style="display: block;font-size:70%;color: red">Deprecated</span>'),o(this,"init",function(){a.handleEvents()}),o(this,"handleEvents",function(){var t=a;a.$(".rtcl-filter-list").on("click","a.rtcl-filter-add, a.rtcl-filter-action-wrap .rtcl-filter-edit",function(t){var e=a.$(t.currentTarget),r={label:a.__("Name","classified-listing"),placeholder:a.__("Form name","classified-listing"),id:"name",required:!0},i={label:a.__("Id","classified-listing"),id:"id",placeholder:a.__("Form Slug/id","classified-listing"),description:a.__("Only english, lowercase, no space, no spacial character allowed","classified-listing")},l=a.$('<button class="rtcl-admin-btn primary">'+a.__("Save Changes","classified-listing")+"</button>");l.on("click",function(t){var e=a.$(".rtcl-ui-modal #rtcl-filter-form");if(!a.formCheckValidation(e))return!1;var r=new FormData(e[0]);r.append("action","rtcl_admin_settings_filter_update_name"),r.append("__rtcl_wpnonce",rtclFilterObj.nonce),n&&r.append("filterId",n),a.$.ajax({url:rtclFilterObj.ajaxurl,cache:!1,processData:!1,contentType:!1,dataType:"json",type:"POST",data:r,beforeSend:function(){a.modal.addLoading()},success:function(t){t.success?(toastr.success(t.data.message),rtclFilterObj.filters=t.data.filters,"new"===t.data.action?a.$(".rtcl-filter-list-wrap").append('<a data-id="'+t.data.filterId+'" class="rtcl-filter-action-wrap"><span class="rtcl-filter-name">'+t.data.filters[t.data.filterId].name+'</span><span class="rtcl-filter-actions"><i class="rtcl-filter-edit dashicons dashicons-edit"></i><i class="rtcl-filter-remove dashicons dashicons-remove"></i></span></a>').find('a[data-id="'+t.data.filterId+'"]').trigger("click"):a.$(".rtcl-filter-list-wrap").find('a[data-id="'+t.data.filterId+'"]').find("span.rtcl-filter-name").text(t.data.filters[t.data.filterId].name),a.modal.removeModel()):toastr.error(t.data)},error:function(t){console.error(t)},complete:function(){a.modal.removeLoading()}})});var n="";e.hasClass("rtcl-filter-edit")&&e.parents(".rtcl-filter-action-wrap").data("id")&&(n=e.parents(".rtcl-filter-action-wrap").data("id"),r.value=rtclFilterObj.filters[n].name,i.value=n,i.readonly=!0);var c=a.$('<form id="rtcl-filter-form"></form>');c.append(a.getRenderedField(r)),c.append(a.getRenderedField(i)),n||(c.find("input[name=name]").on("keyup",function(t){c.find("input[name=id]").val(a.slugify(a.$(t.currentTarget).val()))}),c.find("input[name=id]").on("keyup",function(t){a.$(a).val(a.slugify($(t.currentTarget).val()))})),a.modal.addModal().addTitle(n?a.__("Update Filter form","classified-listing"):a.__("Add new Filter Form","classified-listing")).content(c).addFooterContent(l)}).on("click","a.rtcl-filter-action-wrap",function(t){var e=a.$(t.currentTarget),r=e.data("id");a.$("a.rtcl-filter-action-wrap").removeClass("active"),e.addClass("active");var i=new URL(window.location.href);i.searchParams.set("current_filter",r),window.history.pushState("",document.title,i.toString()),a.renderFilterForm(r)}).on("click","a.rtcl-filter-action-wrap .rtcl-filter-remove",function(t){var e=new FormData;e.append("action","rtcl_admin_settings_filter_remove"),e.append("filterId",a.$(t.currentTarget).parents("a").data("id")),e.append("__rtcl_wpnonce",rtclFilterObj.nonce),confirm("Are you sure to remove?")&&a.$.ajax({url:rtclFilterObj.ajaxurl,cache:!1,processData:!1,contentType:!1,dataType:"json",type:"POST",data:e,beforeSend:function(){a.$wrap.rtclBlock()},success:function(t){if(t.success){toastr.success(t.data.message),rtclFilterObj.filters=t.data.filters,a.$(".rtcl-filter-list-wrap").find('a[data-id="'+t.data.filterId+'"]').remove(),a.$("#rtcl-filter-wrap").empty();var e=new URL(window.location.href);e.searchParams.delete("current_filter"),window.history.pushState("",document.title,e.toString()),a.$(".rtcl-filter-list-wrap").find("a:first-child").trigger("click")}else toastr.error(t.data)},error:function(t){console.error(t)},complete:function(){a.$wrap.rtclUnblock()}})}),a.$("#rtcl-filter-wrap").on("click","#rtcl-filter-add-item",function(e){var l=t.$(e.currentTarget).parents(".rtcl-filter-content").data("id"),n=rtclFilterObj.filters[l],c=t.$('<div id="rtcl-modal-fis"></div>'),o=!1;Object.keys(rtclFilterObj.items).map(function(e){if(-1===n.items.findIndex(function(t){return t.id===e})){o=!0;var d=rtclFilterObj.items[e].label,s=rtclFilterObj.items[e].icon,f=t.$('<div class="rtcl-modal-fi" data-id="'+e+'"><div class="rtcl-mfi-label"><span>'+d+'</span><i class="'+s+'"></i></div><div class="rtcl-mfi-description">Field Name: '+e+"</div></div>");f.on("click",function(n){var c=t.$(n.currentTarget).data("id"),o=rtclFilterObj.items[c],d={filterId:l,itemId:c,data:{}};if(o.fields&&o.fields.length){t.modal.addTitle("Add Item - "+o.label);var s=t.$('<form id="rtcl-filter-form"></form>');o.fields.map(function(e){e.default&&(e.value=e.default),s.append(t.getRenderedField(e))}),t.modal.content(s),"cf"===c&&t.initSortableItems(s);var f=t.$('<button class="rtcl-admin-btn primary">'+t.__("Add Item","classified-listing")+"</button>");f.on("click",function(e){var n=t.$(".rtcl-ui-modal #rtcl-filter-form");if(!t.formCheckValidation(n))return!1;var o,f=i(new FormData(n[0]).entries());try{for(f.s();!(o=f.n()).done;){var u=r(o.value,2),m=u[0],p=u[1];if(m.endsWith("[]")){var v=m.slice(0,-2);d.data[v]||(d.data[v]=[]),d.data[v].push(p)}else d.data[m]?(Array.isArray(d.data[m])||(d.data[m]=[d.data[m]]),d.data[m].push(p)):d.data[m]=p}}catch(t){f.e(t)}finally{f.f()}if("cf"===c){var b=[];s.find(".rtcl-sortable-item").each(function(e,r){var i=t.$(this).data("id");i&&b.push(i)}),d.data.fields_order=b}a.updateItem(d,function(e){rtclFilterObj.filters=e.data.filters,t.renderFilterForm(l),t.modal.removeLoading(),t.modal.close()},function(){t.modal.addLoading()})}),t.modal.addFooterContent(f)}else d.data=rtclFilterObj.items[e].settings?rtclFilterObj.items[e].settings:{},t.updateItem(d,function(e){rtclFilterObj.filters=e.data.filters,t.renderFilterForm(l),t.modal.close()})}),c.append(f)}}),o||(c=t.$("<p>"+t.__("No remaining Item found to add.","classified-listing")+"</p>")),t.modal.addModal().addTitle("Add Item").content(c).addFooterContent("")}).on("click","a.rtcl-filter-control-btn-remove",function(e){if(confirm(t.__("Are you sure to remove!!","classified-listing"))){var r=t.$(e.currentTarget),i=r.parents(".rtcl-filter-content").data("id"),a=r.parents(".rtcl-filter-item").data("id");i&&t.$.ajax({url:rtclFilterObj.ajaxurl,dataType:"json",type:"POST",data:{action:"rtcl_admin_settings_filter_remove_item",__rtcl_wpnonce:rtclFilterObj.nonce,filterId:i,itemId:a},beforeSend:function(){t.$wrap.rtclBlock()},success:function(e){e.success?(toastr.success(e.data.message),rtclFilterObj.filters=e.data.filters,t.renderFilterForm(i)):toastr.error(e.data)},error:function(t){console.error(t)},complete:function(){t.$wrap.rtclUnblock()}})}}).on("click","a.rtcl-filter-control-btn-settings",function(e){var l=t.$(e.currentTarget),n=l.parents(".rtcl-filter-content").data("id"),c=l.parents(".rtcl-filter-item").data("id"),o=rtclFilterObj.filters[n],d=o.items.findIndex(function(t){return t.id===c}),s=o.items[d],f=rtclFilterObj.items[c];if(f.fields&&Array.isArray(f.fields)){t.modal.addModal(),t.modal.addTitle("Edit Item - "+f.label);var u=t.$('<form id="rtcl-filter-form"></form>');f.fields.map(function(e){s[e.id]&&(e.value=s[e.id]),u.append(t.getRenderedField(e))}),a.modal.content(u),"cf"===c&&t.initSortableItems(u);var m=a.$('<button class="rtcl-admin-btn primary">'+a.__("Update Item","classified-listing")+"</button>"),p={filterId:n,itemId:c,data:{}};m.on("click",function(e){var l=a.$(".rtcl-ui-modal #rtcl-filter-form");if(!t.formCheckValidation(l))return!1;var o,d=i(new FormData(l[0]).entries());try{for(d.s();!(o=d.n()).done;){var s=r(o.value,2),f=s[0],m=s[1];if(f.endsWith("[]")){var v=f.slice(0,-2);p.data[v]||(p.data[v]=[]),p.data[v].push(m)}else p.data[f]?(Array.isArray(p.data[f])||(p.data[f]=[p.data[f]]),p.data[f].push(m)):p.data[f]=m}}catch(t){d.e(t)}finally{d.f()}if("cf"===c){var b=[];u.find("#rtcl-filter-modal-fields_order .rtcl-sortable-item").each(function(e,r){var i=t.$(this).data("id");i&&b.push(i)}),p.data.fields_order=b}t.updateItem(p,function(e){rtclFilterObj.filters=e.data.filters,t.renderFilterForm(n),t.modal.removeLoading(),t.modal.close()},function(){t.modal.addLoading()})}),t.modal.addFooterContent(m)}})}),o(this,"slugify",function(t){return t.toString().normalize("NFKD").toLowerCase().trim().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\_/g,"-").replace(/\-\-+/g,"-").replace(/\-$/g,"")}),o(this,"initSortableItems",function(t){(t?t.find(".rtcl-sortable-items"):a.$(document).find(".rtcl-ui-modal #rtcl-filter-form .rtcl-sortable-items")).sortable({handle:".rtcl-sortable-handle",helper:"clone",sort:function(t,e){e.helper.css("top",e.position.top+24+"px")}})}),o(this,"getRenderedField",function(t){if(t){var r,i=t.value?t.value:"",l=a.$('<div class="rtcl-modal-field"><div class="rtcl-mf-label"><label for="rtcl-filter-modal-'+t.id+'">'+t.label+'</label></div><div class="rtcl-mf-content"></div></div>');if("switch"===t.type){var n=i?" checked":"";r=a.$('<input type="checkbox" id="rtcl-filter-modal-'+t.id+'" name="'+t.id+'" value="1"'+n+" />")}else if("checkbox"===t.type){r=a.$('<div class="rtcl-checkbox-group"/>'),t.required&&r.addClass("required");var c=t.options;c&&Object.keys(c).map(function(e){var l=a.$('<label><input type="checkbox" id="rtcl-modal-checkbox-'+t.id+"-"+e+'" name="'+t.id+'[]" value="'+e+'" /><span class="label-text">'+c[e]+"</span></label>");Array.isArray(i)&&i.some(function(t){return t==e})&&l.find("input").prop("checked",!0),r.append(l)})}else if("select"===t.type){r=a.$('<select id="rtcl-filter-modal-'+t.id+'" name="'+t.id+'" />'),t.required&&r.addClass("required");var o=t.options;o&&Object.keys(o).map(function(t){var e=a.$("<option />").val(t).text(o[t]);i&&t===i&&e.prop("selected",!0),r.append(e)})}else if("number"===t.type)r=a.$('<input id="rtcl-filter-modal-'+t.id+'" type="number" name="'+t.id+'" value="'+i+'" />'),t.required&&r.addClass("required");else if("cf_fields_order"===t.type){var d=[];rtclFilterObj.forms.map(function(t){Object.keys(t.fields).map(function(e){var r=t.fields[e];!r.preset&&r.filterable&&(r.form={id:t.id,title:t.title},d.push(r))})}),d.length&&i&&Array.isArray(i)&&i.length&&i.map(function(t,r){var i=d.findIndex(function(e){return e.uuid===t});-1!==i&&i!==r&&function(t,r,i){if(i>=t.length){var a=i-t.length+1;t.push.apply(t,e(Array(a)))}t.splice(i,0,t.splice(r,1)[0])}(d,i,r)}),r=a.$('<div class="cf-field-order rtcl-sortable-items" id="rtcl-filter-modal-'+t.id+'" />'),d.filter(function(t){return t}).map(function(t){var e,i=jQuery('<div class="rtcl-sortable-item" data-id="'+t.uuid+'"><div class="rtcl-sortable-handle">'+(t.label||t.name||t.element)+" (Form: "+t.form.title+")</div></div>");"class"===(null===(e=t.icon)||void 0===e?void 0:e.type)&&t.icon.class&&i.find(".rtcl-sortable-handle").prepend('<i class="'+t.icon.class+'"/>'),r.append(i)})}else r=a.$('<input id="rtcl-filter-modal-'+t.id+'" type="text" name="'+t.id+'" value="'+i+'" />'),t.required&&r.addClass("required"),t.placeholder&&(r.addClass("required"),r.attr("placeholder",t.placeholder));return r&&(t.readonly&&r.prop("disabled",!0).attr("readonly",!0),l.find(".rtcl-mf-content").append(r)),t.description&&l.find(".rtcl-mf-content").append('<div class="description">'+t.description+"</div>"),l}}),o(this,"updateItemsOrder",function(t){var e=[];a.$("#rtcl-filter-wrap .rtcl-filter-items .rtcl-filter-item").each(function(t,r){e.push(a.$(r).data("id"))}),a.$.ajax({url:rtclFilterObj.ajaxurl,dataType:"json",type:"POST",data:{action:"rtcl_admin_settings_filter_update_items_order",__rtcl_wpnonce:rtclFilterObj.nonce,filterId:t,itemKeys:e},beforeSend:function(){a.$wrap.rtclBlock()},success:function(t){t.success?(rtclFilterObj.filters=t.data.filters,toastr.success(t.data.message)):toastr.error(t.data)},error:function(t){console.error(t)},complete:function(){a.$wrap.rtclUnblock(),a.renderFilterForm(t)}})}),o(this,"renderFilterForm",function(t){var e=rtclFilterObj.filters[t],r=a.$('<div class="rtcl-filter-content"><div class="rtcl-filter-items"></div><div class="rtcl-filter-action"><button type="button" class="rtcl-admin-btn primary" id="rtcl-filter-add-item"><span class="dashicons dashicons-plus-alt2"></span></button></div></div>');r.data("id",t),e.items&&Array.isArray(e.items)&&(e.items.map(function(t){if(rtclFilterObj.items[t.id]){var e=a.$('<div class="rtcl-filter-item" />');e.data("id",t.id);var i=a.$('<div class="rtcl-filter-item-title"><div class="rtcl-filter-item-handle"><i class="rtcl-icon-move"></i><span class="rtcl-filter-item-label">'+rtclFilterObj.items[t.id].label+'</span></div><div class="rtcl-filter-item-icon"><i class="'+rtclFilterObj.items[t.id].icon+'"></i></div></div>'),l=a.$('<div class="rtcl-filter-item-control"><a class="rtcl-filter-control-btn rtcl-filter-control-btn-remove"><i class="dashicons dashicons-trash"></i></a></div>'),n=rtclFilterObj.items[t.id];n&&n.fields&&Array.isArray(n.fields)&&l.prepend('<a class="rtcl-filter-control-btn rtcl-filter-control-btn-settings"><i class="dashicons dashicons-admin-generic"></i></a>'),e.append(i,l),r.find(".rtcl-filter-items").append(e)}}),a.$("#rtcl-filter-wrap").html(r),a.$("#rtcl-filter-wrap .rtcl-filter-items").sortable({handle:".rtcl-filter-item-handle",helper:"clone",start:function(t,e){e.item.addClass("dragging")},stop:function(e,r){r.item.removeClass("dragging"),a.updateItemsOrder(t)}}))}),o(this,"updateItem",function(t,e,r,i){t.action="rtcl_admin_settings_filter_update_item",t.__rtcl_wpnonce=rtclFilterObj.nonce,a.$.ajax({url:rtclFilterObj.ajaxurl,dataType:"json",type:"POST",data:t,beforeSend:function(){r&&r(),a.$wrap.rtclBlock()},success:function(t){t.success?(toastr.success(t.data.message),e&&e(t)):toastr.error(t.data)},error:function(t){i&&i(),console.error(t)},complete:function(){a.$wrap.rtclUnblock()}})}),o(this,"formCheckValidation",function(t){var e=0;return t.find(".required").each(function(t,r){var i=a.$(r);""===i.val()&&(i.parent().addClass("invalid"),e++)}),!(e>0)||(toastr.error("Some field has incorrect value"),!1)}),this.$=jQuery,this.__=wp.i18n.__,this.$wrap=this.$("#rtcl-filter-settings-wrap"),this.modal=new RtclModal({maxWidth:800})});!function(t,e){var r=new s;t(function(){r.init();var i=new URL(e.location.href).searchParams.get("current_filter");i?t(".rtcl-filter-list-wrap a.rtcl-filter-action-wrap[data-id="+i+"]").trigger("click"):t(".rtcl-filter-list a.rtcl-filter-action-wrap:first-child").trigger("click")})}(jQuery,window)})();