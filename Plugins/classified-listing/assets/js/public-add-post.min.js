!function(t){t.fn.getType=function(){return"INPUT"===this[0].tagName?this[0].type.toLowerCase():this[0].tagName.toLowerCase()};var e='<div class="rtcl-spinner block"><span class="rtcl-icon-spinner animate-spin"></span></div>';function r(e){var r=t(".rtcl-tags-input-wrap"),a=r.find("#rtcl_listing_tag"),n=a.val();(n=n?n.split(",").map(function(t){return t.trim()}):[]).push(e),a.val(n.join(", "));var c=t('<div><span class="rtcl-tag-term">'+e+'</span><span class="remove">x</span></div>');r.find(".rtcl-tags-input").find("div").length?c.insertAfter(r.find(".rtcl-tags-input").find("div").last()):r.find(".rtcl-tags-input").prepend(c),r.find("ul").remove(),r.find("#new-tag-rtcl_tag").val("").focus()}if(t(document.body).on("rtcl_add_error_tip",function(e,r,a){var n=r.position();0===r.parent().find(".rtcl_error_tip").length&&(r.after('<div class="rtcl_error_tip '+a+'">'+rtcl[a]+"</div>"),r.parent().find(".rtcl_error_tip").css("left",n.left+r.width()-r.width()/2-t(".rtcl_error_tip").width()/2).css("top",n.top+r.height()).fadeIn("100"))}).on("rtcl_remove_error_tip",function(e,r,a){r.parent().find(".rtcl_error_tip."+a).fadeOut("100",function(){t(this).remove()})}).on("click",function(){t(".rtcl_error_tip").fadeOut("100",function(){t(this).remove()})}).on("blur","#rtcl-price[type=text], input.rtcl-price",function(){t(".rtcl_error_tip").fadeOut("100",function(){t(this).remove()})}).on("keyup","#rtcl-price[type=text], input.rtcl-price",function(){var e=new RegExp("[^-0-9%\\"+rtcl.decimal_point+"]+","gi"),r="i18n_mon_decimal_error",a=t(this).val(),n=a.replace(e,"");a!==n?t(document.body).triggerHandler("rtcl_add_error_tip",[t(this),r]):t(document.body).triggerHandler("rtcl_remove_error_tip",[t(this),r])}).on("change","#rtcl-price[type=text], input.rtcl-price",function(){var e=new RegExp("[^-0-9%\\"+rtcl.decimal_point+"]+","gi"),r=t(this).val(),a=r.replace(e,"");r!==a&&t(this).val(a)}).on("rtcl_price_type_changed",function(e,r){"on_call"===r.value||"free"===r.value||"no_price"===r.value?t("#rtcl-price").attr("required","false").val(""):t("#rtcl-price").attr("required","true"),t("#rtcl-price-items").removeClass(function(t,e){return(e.match(/(^|\s)rtcl-price-type\S+/g)||[]).join(" ")}).addClass("rtcl-price-type-"+r.value)}).on("rtcl_listing_pricing_type_changed",function(e,r){t("#rtcl-pricing-items").removeClass().addClass("rtcl-pricing-"+r.value)}).on("change","#rtcl-price-type",function(){t(document.body).trigger("rtcl_price_type_changed",[this])}).on("change","input[name=_rtcl_listing_pricing]",function(){t(document.body).trigger("rtcl_listing_pricing_type_changed",[this])}).on("keyup","#new-tag-rtcl_tag",function(e){var a=t(this),n=a.closest(".rtcl-tags-input-wrap"),c=a.val(),l={action:"rtcl_tag_search",__rtcl_wpnonce:rtcl.__rtcl_wpnonce,q:c,number:20};switch(e.keyCode){case 188:return void r(c.trim().replace(",",""));case 40:return void(0===n.find("ul li[active]").length?n.find("ul li").first().attr("active","1").css("background-color","#f6f6f6"):n.find("ul li[active]").removeAttr("active").css("background-color","#ffffff").next().attr("active","1").css("background-color","#f6f6f6"));case 38:return void(0===n.find("ul li[active]").length?n.find("ul li").last().attr("active","1").css("background-color","#f6f6f6"):n.find("ul li[active]").removeAttr("active").css("background-color","#ffffff").prev().attr("active","1").css("background-color","#f6f6f6"));case 13:var i=n.find("ul li[active]");if(i.length)r(i.text()),i.removeAttr("active").css("background-color","#ffffff");return}c.length>1?t.ajax({url:rtcl.ajaxurl,data:l,type:"GET",dataType:"json",beforeSend:function(){n.find("ul").remove()},success:function(t){n.append(t.list)},error:function(t){n.find("ul").remove(),console.log(t.responseText)}}):n.find("ul").remove()}).on("click",".rtcl-tags-input-wrap ul li",function(){r(t(this).text())}).on("click",".rtcl-tags-input div span.remove",function(){var e=t(this),r=e.closest("div").find(".rtcl-tag-term").text();e.closest("div").remove(),function(e){var r=t(".rtcl-tags-input-wrap"),a=r.find("#rtcl_listing_tag"),n=a.val();n=n?n.split(",").filter(function(t){return t.trim()!==e}):[],a.val(n.join(", "))}(r)}),t.fn.validate){var a=t("form#rtcl-post-form");t(".rtcl-tags-input-wrap").length&&a.on("keypress",function(t){"TEXTAREA"!==t.target.nodeName&&13===t.keyCode&&t.preventDefault()}),a.length&&a.validate({rules:{_rtcl_max_price:{greaterThan:"#rtcl-price"}},messages:{_rtcl_max_price:{greaterThan:rtcl_validator.messages.maxPrice}},submitHandler:function(e){var r=t(e),n=r.data("reCaptchaId");try{tinymce.triggerSave(),tinymce.get("description").save()}catch(t){}if(rtcl.recaptcha&&rtcl.recaptcha.on&&-1!==t.inArray("listing",rtcl.recaptcha.on)){if(2===rtcl.recaptcha.v&&void 0!==n){var c=grecaptcha.getResponse(n),l=r.find("#rtcl-listing-g-recaptcha-message");return 0===c.length?(l.addClass("text-danger").html(rtcl.recaptcha.msg.invalid),grecaptcha.reset(n),!1):(i(),!1)}if(3===rtcl.recaptcha.v)return grecaptcha.ready(function(){r.rtclBlock(),grecaptcha.execute(rtcl.recaptcha.site_key,{action:"listing"}).then(function(t){i(t)})}),!1}return i(),!1;function i(n){var c=new FormData(e),l=t("<div class='alert rtcl-response'></div>");return n&&c.set("g-recaptcha-response",n),c.set("action","rtcl_post_new_listing"),t.ajax({url:rtcl.ajaxurl,type:"POST",dataType:"json",cache:!1,contentType:!1,processData:!1,data:c,beforeSend:function(){r.find(".alert.rtcl-response").remove(),r.find("button[type=submit]").prop("disabled",!0),r.rtclBlock()},success:function(t){r.find("button[type=submit]").prop("disabled",!1),r.rtclUnblock();var e="";t.message.length&&t.message.map(function(t){e+="<p>"+t+"</p>"}),t.success?(a[0].reset(),e&&l.removeClass("alert-danger").addClass("alert-success").html(e).appendTo(a),t.redirect_url&&setTimeout(function(){window.location.href=t.redirect_url},500)):e&&l.removeClass("alert-success").addClass("alert-danger").html(e).appendTo(a)},error:function(t){l.removeClass("alert-success").addClass("alert-danger").html(t.responseText).appendTo(a),r.find("button[type=submit]").prop("disabled",!1),r.rtclUnblock()}}),!1}}})}t(document).ready(function(){if(rtcl_add_post.character_limit.title&&t("#rtcl-title").on("keyup",function(){var e=t(this),r=t(this).val(),a=rtcl_add_post.character_limit.title;if(a){var n=e.parents(".form-group").find(".target-limit");n.length&&n.text(r?a-r.length:a)}}),rtcl_add_post.character_limit.description){var r=rtcl_add_post.character_limit.description;if(t("#description").on("keyup",function(e){var a=t(this),n=t(this).val(),c=a.parents(".form-group").find(".target-limit");if(c.length){var l=n?r-n.length:r;l<=0?(c.text(0),a.val(n.substring(0,r))):c.text(l)}}),"undefined"!=typeof tinyMCE){var a=tinyMCE.get("description");if(a){var n=function(t){var e=a.getContent(),n=(e=e.replace(/(<[a-zA-Z\/][^<>]*>|\[([^\]]+)\])|(\s+)/gi,""))?r-e.length:r;e.length>=r?(c.text(0),t.preventDefault()):c.text(n)},c=t("#description").parents(".form-group").find(".target-limit");a.on("keypress",n),a.on("keyup",n),a.on("change",n)}}}t("#rtcl-ad-type").on("change",function(){var r=t(this),a=r.val(),n=t("<div class='alert rtcl-response'></div>"),c=r.parents("#rtcl-ad-type-selection"),l=t("#rtcl-ad-category-selection"),i=t("#rtcl-sub-category-wrap"),s=t("#sub-cat-row"),o={action:"rtcl_get_one_level_category_select_list_by_type",type:a,__rtcl_wpnonce:rtcl.__rtcl_wpnonce};a?t.ajax({url:rtcl.ajaxurl,data:o,type:"POST",dataType:"json",beforeSend:function(){t(e).insertAfter(r),c.find(".alert.rtcl-response").remove(),l.find(".alert.rtcl-response").remove(),s.addClass("rtcl-hide"),i.html("")},success:function(e){r.next(".rtcl-spinner").remove(),s.addClass("rtcl-hide"),i.html("");var a="";e.message.length&&e.message.map(function(t){a+="<p>"+t+"</p>"}),e.success?(t("#rtcl-category").html(e.cats),l.slideDown()):(t("#rtcl-category").html(""),l.slideUp(),a&&n.removeClass("alert-success").addClass("alert-danger").html(a).appendTo(c))},error:function(t){r.next(".rtcl-spinner").remove(),n.removeClass("alert-success").addClass("alert-danger").html(t.responseText).appendTo(c)}}):(l.slideUp(),s.addClass("rtcl-hide"),i.html(""))}),t("#rtcl-category").on("change",function(){var r=t(this),a=r.parents(".rtcl-post-category"),n=t("#rtcl-sub-category-wrap"),c=t("#sub-cat-row"),l=t(this).val(),i=t("#rtcl-ad-type"),s=i.val()||"",o=t("<div class='alert rtcl-response'></div>"),d={action:"rtcl_get_one_level_category_select_list",term_id:l,__rtcl_wpnonce:rtcl.__rtcl_wpnonce};!s&&rtcl_add_post.hide_ad_type||s&&!rtcl_add_post.hide_ad_type?l?t.ajax({url:rtcl.ajaxurl,data:d,type:"POST",dataType:"json",beforeSend:function(){t(e).insertAfter(r),a.find(".alert.rtcl-response").remove()},success:function(e){if(r.next(".rtcl-spinner").remove(),e.success)if(e.child_cats)n.html(t('<select class="form-control" required />').append(e.child_cats)),c.removeClass("rtcl-hide");else{n.html(""),c.addClass("rtcl-hide");var i=rtcl_add_post.form_uri.toString(),d={category:l},p=-1!==i.indexOf("?")?"&":"?";!rtcl_add_post.hide_ad_type&&s&&(d.type=s),i=i+p+t.param(d),window.location=i}else if(c.addClass("rtcl-hide"),e.message.length){var u="";e.message.map(function(t){u+="<p>"+t+"</p>"}),u&&o.removeClass("alert-success").addClass("alert-danger").html(u).appendTo(a)}},error:function(t){r.next(".rtcl-spinner").remove(),o.removeClass("alert-success").addClass("alert-danger").html(t.responseText).appendTo(a)}}):(n.html(""),c.addClass("rtcl-hide")):(alert(rtcl_add_post.message.ad_type),i.focus())}),t(document).on("change","#rtcl-sub-category-wrap select",function(){var r=t(this),a=r.parents("#rtcl-sub-category-wrap"),n=t(this).val(),c=t("#rtcl-ad-type"),l=c.val()||"",i=t("<div class='alert rtcl-response'></div>"),s={action:"rtcl_get_one_level_category_select_list",term_id:n,__rtcl_wpnonce:rtcl.__rtcl_wpnonce};!l&&rtcl_add_post.hide_ad_type||l&&!rtcl_add_post.hide_ad_type?n?t.ajax({url:rtcl.ajaxurl,data:s,type:"POST",dataType:"json",beforeSend:function(){t(e).insertAfter(r),a.find(".alert.rtcl-response").remove(),r.nextAll("select").remove()},success:function(e){if(a.find(".rtcl-spinner").remove(),e.success)if(e.child_cats)a.append(t('<select class="form-control" required />').append(e.child_cats));else{var c=rtcl_add_post.form_uri.toString(),s={category:n},o=-1!==c.indexOf("?")?"&":"?";!rtcl_add_post.hide_ad_type&&l&&(s.type=l),c=c+o+t.param(s),window.location=c}else if(r.nextAll("select").remove(),e.message.length){var d="";e.message.map(function(t){d+="<p>"+t+"</p>"}),d&&i.removeClass("alert-success").addClass("alert-danger").html(d).appendTo(a)}},error:function(t){a.find(".rtcl-spinner").remove(),i.removeClass("alert-success").addClass("alert-danger").html(t.responseText).appendTo(a)}}):r.nextAll("select").remove():(alert(rtcl_add_post.message.ad_type),c.focus())}),t("#rtcl-location").on("change",function(){var r=t(this),a=t("#rtcl-sub-location"),n=a.parents("#sub-location-row"),c={action:"rtcl_get_sub_location_options",term_id:t(this).val(),__rtcl_wpnonce:rtcl.__rtcl_wpnonce};t.ajax({url:rtcl.ajaxurl,data:c,type:"POST",dataType:"json",beforeSend:function(){t(e).insertAfter(r)},success:function(e){r.next(".rtcl-spinner").remove(),a.find("option").each(function(){t(this).val().trim()&&t(this).remove()}),a.append(e.locations),e.locations?n.removeClass("rtcl-hide"):n.addClass("rtcl-hide")},error:function(){r.next(".rtcl-spinner").remove()}})}),t("#rtcl-sub-location").on("change",function(){var r=t(this),a=t("#rtcl-sub-sub-location"),n=a.parents("#sub-sub-location-row"),c={action:"rtcl_get_sub_location_options",term_id:t(this).val(),__rtcl_wpnonce:rtcl.__rtcl_wpnonce};t.ajax({url:rtcl.ajaxurl,data:c,type:"POST",dataType:"json",beforeSend:function(){t(e).insertAfter(r)},success:function(e){r.next(".rtcl-spinner").remove(),a.find("option").each(function(){t(this).val().trim()&&t(this).remove()}),a.append(e.locations),e.locations?n.removeClass("rtcl-hide"):n.addClass("rtcl-hide")},error:function(){r.next(".rtcl-spinner").remove()}})})}),t(window).bind("beforeunload",function(){var e=parseInt(t("#_post_id").val(),10);if(e&&0!==e&&!isNaN(e)){var r={action:"rtcl_delete_temp_listing",__rtcl_wpnonce:rtcl.__rtcl_wpnonce,id:e};t.ajax(rtcl.ajaxurl,{data:r,dataType:"json",type:"post",success:function(t){}})}})}(jQuery);
